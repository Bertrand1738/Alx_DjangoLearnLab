option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: social_media_api.wsgi:application
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /static: staticfiles
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: social_media_api.production_settings
    PYTHONPATH: /var/app/current
  aws:elasticbeanstalk:environment:process:default:
    HealthCheckPath: /api/health/
    MatcherHTTPCode: "200"
  aws:autoscaling:launchconfiguration:
    SecurityGroups: web-server-sg
  aws:ec2:vpc:
    VPCId: vpc-xxxxxxxx  # Replace with your VPC ID
    Subnets: subnet-xxxxxxxx  # Replace with your subnet ID
    ELBSubnets: subnet-xxxxxxxx  # Replace with your ELB subnet ID

packages:
  yum:
    postgresql-devel: []
    python3-devel: []
    gcc: []

container_commands:
  01_migrations:
    command: "source /var/app/venv/*/bin/activate && python manage.py migrate --noinput"
    leader_only: true
  02_collectstatic:
    command: "source /var/app/venv/*/bin/activate && python manage.py collectstatic --noinput"
  03_createsu:
    command: "source /var/app/venv/*/bin/activate && python manage.py createsu"
    leader_only: true
