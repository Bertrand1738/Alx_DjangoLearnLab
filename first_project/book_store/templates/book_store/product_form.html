{% extends 'book_store/base.html' %}

{% block title %}{{ title }} - Book Store{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h3>{{ title }}</h3>
            </div>
            <div class="card-body">
                <!-- Security Notice -->
                <div class="alert alert-info">
                    <small>
                        <i class="fas fa-shield-alt"></i>
                        <strong>Security:</strong> This form includes input validation and CSRF protection.
                    </small>
                </div>
                
                <!-- Form Errors -->
                {% if form.non_field_errors %}
                    <div class="alert alert-danger">
                        {{ form.non_field_errors }}
                    </div>
                {% endif %}
                
                <form method="post" class="needs-validation" novalidate>
                    {% csrf_token %}
                    
                    <!-- Product Name -->
                    <div class="mb-3">
                        <label for="{{ form.name.id_for_label }}" class="form-label">
                            Product Name <span class="text-danger">*</span>
                        </label>
                        {{ form.name }}
                        {% if form.name.errors %}
                            <div class="text-danger small">
                                {{ form.name.errors|join:", " }}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            Enter a unique product name (2-100 characters).
                        </div>
                    </div>
                    
                    <!-- Description -->
                    <div class="mb-3">
                        <label for="{{ form.description.id_for_label }}" class="form-label">
                            Description <span class="text-danger">*</span>
                        </label>
                        {{ form.description }}
                        {% if form.description.errors %}
                            <div class="text-danger small">
                                {{ form.description.errors|join:", " }}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            Provide a detailed description (10-1000 characters).
                        </div>
                    </div>
                    
                    <!-- Price -->
                    <div class="mb-3">
                        <label for="{{ form.price.id_for_label }}" class="form-label">
                            Price <span class="text-danger">*</span>
                        </label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            {{ form.price }}
                        </div>
                        {% if form.price.errors %}
                            <div class="text-danger small">
                                {{ form.price.errors|join:", " }}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            Enter price between $0.01 and $9,999.99.
                        </div>
                    </div>
                    
                    <!-- Category -->
                    <div class="mb-3">
                        <label for="{{ form.category.id_for_label }}" class="form-label">
                            Category <span class="text-danger">*</span>
                        </label>
                        {{ form.category }}
                        {% if form.category.errors %}
                            <div class="text-danger small">
                                {{ form.category.errors|join:", " }}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            Choose from: Programming, Web Development, Data Science, Machine Learning, Database, Mobile Development, Development Tools, Computer Science, Design, Business, Fiction, Non-Fiction, Education.
                        </div>
                    </div>
                    
                    <!-- Submit Buttons -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{% url 'products' %}" class="btn btn-secondary me-md-2">
                            Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            {% if product %}
                                Update Product
                            {% else %}
                                Add Product
                            {% endif %}
                        </button>
                    </div>
                </form>
                
                <!-- Security Information -->
                <div class="mt-4">
                    <h6>ðŸ”’ Security Features Implemented:</h6>
                    <ul class="small text-muted">
                        <li>CSRF token protection against cross-site request forgery</li>
                        <li>Input validation and sanitization</li>
                        <li>XSS prevention through template auto-escaping</li>
                        <li>Business logic validation for pricing rules</li>
                        <li>Duplicate name prevention</li>
                        <li>Length and format validation for all fields</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Client-side validation (additional layer, server-side is primary)
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.needs-validation');
    
    form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    });
    
    // Real-time character counting for description
    const descriptionField = document.getElementById('{{ form.description.id_for_label }}');
    if (descriptionField) {
        const charCount = document.createElement('small');
        charCount.className = 'text-muted';
        descriptionField.parentNode.appendChild(charCount);
        
        function updateCharCount() {
            const remaining = 1000 - descriptionField.value.length;
            charCount.textContent = `${descriptionField.value.length}/1000 characters`;
            charCount.className = remaining < 100 ? 'text-warning' : 'text-muted';
        }
        
        descriptionField.addEventListener('input', updateCharCount);
        updateCharCount();
    }
});
</script>
{% endblock %}
